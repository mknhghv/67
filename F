-- ç„ä¸›è…³æœ¬ - çµ‚æ¥µç°¡åŒ–ç‰ˆ + é›ªèŠ±å‹•ç•«
print("ğŸ® =================================")
print("ğŸ® ç„ä¸›è…³æœ¬ - çµ‚æ¥µç°¡åŒ–ç‰ˆ + é›ªèŠ±")
print("ğŸ® åŒ…å«ï¼šå¿«é€Ÿæ”»æ“Š + çš®è…³æœ¬ + é›ªèŠ±å‹•ç•«")
print("ğŸ® =================================")

-- ç¢ºä¿éŠæˆ²å®Œå…¨åŠ è¼‰
repeat task.wait() until game:IsLoaded()

-- ç²å–ç©å®¶
local player = game.Players.LocalPlayer
if not player then
    warn("âŒ ç„¡æ³•ç²å–ç©å®¶")
    return
end

-- ç­‰å¾…PlayerGui
task.wait(2)
local playerGui = player:WaitForChild("PlayerGui", 5)
if not playerGui then
    warn("âŒ ç„¡æ³•æ‰¾åˆ°PlayerGuiï¼Œå˜—è©¦ä½¿ç”¨CoreGui")
    playerGui = game:GetService("CoreGui")
end

print("âœ… ä½¿ç”¨UIå®¹å™¨: " .. playerGui.Name)

-- æ¸…ç†èˆŠçš„UI
if playerGui:FindFirstChild("XuanCongScript_Snow") then
    playerGui.XuanCongScript_Snow:Destroy()
    print("ğŸ—‘ï¸ æ¸…ç†äº†èˆŠçš„UI")
end

-- ========================
-- å…¨å±€è®Šé‡
-- ========================
local tweenService = game:GetService("TweenService")
local inputService = game:GetService("UserInputService")
local runService = game:GetService("RunService")

-- åŠŸèƒ½ç‹€æ…‹è®Šé‡
_G.XuanCongUILoaded = true
local isFastAttackOn = false
local isPiScriptOn = false

-- åŠŸèƒ½ç³»çµ±
local fastAttackSystem = nil

-- ========================
-- å‰µå»ºScreenGui
-- ========================
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "XuanCongScript_Snow"
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.DisplayOrder = 999
screenGui.IgnoreGuiInset = true

_G.XuanCongUIInstance = screenGui

print("âœ… ScreenGuiå·²å‰µå»º")

-- ========================
-- å‰µå»ºä¸»æ¡†æ¶
-- ========================
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 260, 0, 180)
mainFrame.Position = UDim2.new(0.5, -130, 0.5, -90)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 35, 50)  -- æ”¹ç‚ºå†¬æ—¥è—è‰²èª¿
mainFrame.BackgroundTransparency = 0.1
mainFrame.BorderSizePixel = 0
mainFrame.Visible = true
mainFrame.ClipsDescendants = true  -- è®“é›ªèŠ±ä¸æœƒè¶…å‡ºé‚Šç•Œ
mainFrame.Parent = screenGui

-- åœ“è§’
local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0, 10)
uiCorner.Parent = mainFrame

-- é‚Šæ¡†å’Œé™°å½±æ•ˆæœ
local uiStroke = Instance.new("UIStroke")
uiStroke.Color = Color3.fromRGB(100, 150, 200)  -- å†°è—è‰²é‚Šæ¡†
uiStroke.Thickness = 2
uiStroke.Parent = mainFrame

-- èƒŒæ™¯æ¼¸è®Š (å†¬æ—¥ä¸»é¡Œ)
local bgGradient = Instance.new("UIGradient")
bgGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(30, 40, 60)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(35, 45, 70)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(25, 35, 55))
})
bgGradient.Rotation = 45
bgGradient.Parent = mainFrame

print("âœ… ä¸»æ¡†æ¶å·²å‰µå»º")

-- ========================
-- é›ªèŠ±é£„è½ç³»çµ±
-- ========================
print("â„ï¸ åˆå§‹åŒ–é›ªèŠ±ç³»çµ±...")

local snowflakes = {}
local snowTypes = {
    {symbol = "â„ï¸", size = 18, speed = 25, sway = 0.2, spin = 1.5},
    {symbol = "â„ï¸", size = 16, speed = 30, sway = 0.3, spin = 2},
    {symbol = "ï¼Š", size = 14, speed = 35, sway = 0.4, spin = -1.8},
    {symbol = "âœ±", size = 12, speed = 40, sway = 0.5, spin = 2.5}
}

-- å‰µå»ºåˆå§‹é›ªèŠ±
for i = 1, 12 do
    local snowType = snowTypes[math.random(1, #snowTypes)]
    
    local snowflake = Instance.new("TextLabel")
    snowflake.Name = "Snowflake_" .. i
    snowflake.Size = UDim2.new(0, snowType.size, 0, snowType.size)
    
    -- éš¨æ©Ÿèµ·å§‹ä½ç½® (å¾é ‚éƒ¨é–‹å§‹)
    local startX = math.random(-20, 240)
    local startY = math.random(-30, -10)
    
    snowflake.Position = UDim2.new(0, startX, 0, startY)
    snowflake.BackgroundTransparency = 1
    snowflake.Text = snowType.symbol
    snowflake.TextColor3 = Color3.fromRGB(180, 220, 255)
    snowflake.Font = Enum.Font.SourceSansBold
    snowflake.TextSize = snowType.size - 4
    snowflake.ZIndex = 0
    snowflake.Parent = mainFrame
    
    table.insert(snowflakes, {
        object = snowflake,
        speed = snowType.speed * (0.8 + math.random() * 0.4),
        sway = snowType.sway * (0.5 + math.random() * 1),
        spinSpeed = snowType.spin * (0.5 + math.random()),
        swayOffset = math.random() * math.pi * 2,
        floatPhase = math.random() * math.pi * 2,
        transparency = 0.4 + math.random() * 0.4
    })
end

-- é›ªèŠ±å‹•ç•«é€£æ¥
local snowAnimation
snowAnimation = runService.Heartbeat:Connect(function(deltaTime)
    local time = tick()
    
    for i, snowData in ipairs(snowflakes) do
        if snowData.object and snowData.object.Parent then
            local flake = snowData.object
            
            -- ç•¶å‰ä½ç½®
            local currentX = flake.Position.X.Offset
            local currentY = flake.Position.Y.Offset
            
            -- ä¸‹è½
            local newY = currentY + snowData.speed * deltaTime
            
            -- å·¦å³é£„å‹•
            local swayX = math.sin(time * 1.5 + snowData.swayOffset) * snowData.sway * 20
            local newX = currentX + swayX
            
            -- æ—‹è½‰
            flake.Rotation = flake.Rotation + snowData.spinSpeed
            
            -- è¼•å¾®æµ®å‹•
            local floatY = math.sin(time * 2 + snowData.floatPhase) * 2
            
            -- é‚Šç•Œæª¢æŸ¥
            if newY > 190 then  -- è¶…å‡ºåº•éƒ¨
                newY = -20
                newX = math.random(-20, 240)
            end
            
            if newX < -30 then  -- è¶…å‡ºå·¦é‚Š
                newX = 270
            elseif newX > 270 then  -- è¶…å‡ºå³é‚Š
                newX = -30
            end
            
            -- æ‡‰ç”¨æ–°ä½ç½®
            flake.Position = UDim2.new(0, newX, 0, newY + floatY)
            
            -- é€æ˜åº¦è®ŠåŒ– (è¼•å¾®é–ƒçˆ)
            local alpha = snowData.transparency + 0.2 * math.sin(time * 1.2 + snowData.floatPhase)
            flake.TextTransparency = alpha
        end
    end
end)

-- ========================
-- æ¨™é¡Œæ¬„
-- ========================
local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 40)
titleBar.Position = UDim2.new(0, 0, 0, 0)
titleBar.BackgroundColor3 = Color3.fromRGB(40, 60, 90)
titleBar.BackgroundTransparency = 0.2
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

-- æ¨™é¡Œæ¬„åœ“è§’
local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 10)
titleCorner.Parent = titleBar

-- æ¨™é¡Œæ¬„æ¼¸è®Šæ•ˆæœ
local titleGradient = Instance.new("UIGradient")
titleGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(50, 70, 100)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(60, 90, 140)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(40, 60, 90))
})
titleGradient.Parent = titleBar

-- æ¨™é¡Œæ–‡å­—
local titleText = Instance.new("TextLabel")
titleText.Name = "TitleText"
titleText.Size = UDim2.new(0.6, 0, 1, 0)
titleText.Position = UDim2.new(0, 15, 0, 0)
titleText.BackgroundTransparency = 1
titleText.Text = "â„ï¸ ç„ä¸›è…³æœ¬ ç§¦å§‹çš‡å‰µä½œ"
titleText.TextColor3 = Color3.fromRGB(200, 230, 255)
titleText.Font = Enum.Font.GothamBold
titleText.TextSize = 16
titleText.TextXAlignment = Enum.TextXAlignment.Left
titleText.Parent = titleBar

-- ========================
-- é—œé–‰æŒ‰éˆ•
-- ========================
local closeButton = Instance.new("TextButton")
closeButton.Name = "CloseButton"
closeButton.Size = UDim2.new(0, 30, 0, 30)
closeButton.Position = UDim2.new(1, -40, 0.5, -15)
closeButton.BackgroundColor3 = Color3.fromRGB(220, 100, 100)
closeButton.BorderSizePixel = 0
closeButton.Text = "X"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 16
closeButton.AutoButtonColor = true
closeButton.Parent = titleBar

-- é—œé–‰æŒ‰éˆ•åœ“è§’
local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 6)
closeCorner.Parent = closeButton

print("âœ… æ¨™é¡Œæ¬„å·²å‰µå»º")

-- ========================
-- å‰µå»ºåŠŸèƒ½æŒ‰éˆ•å‡½æ•¸ (å†¬æ—¥é¢¨æ ¼)
-- ========================
local function createFeatureButton(parent, name, text, icon, yPosition, color)
    local buttonFrame = Instance.new("Frame")
    buttonFrame.Name = name .. "Frame"
    buttonFrame.Size = UDim2.new(1, -20, 0, 36)
    buttonFrame.Position = UDim2.new(0, 10, 0, yPosition)
    buttonFrame.BackgroundColor3 = Color3.fromRGB(40, 50, 70)
    buttonFrame.BackgroundTransparency = 0.3
    buttonFrame.BorderSizePixel = 0
    buttonFrame.ZIndex = 2  -- ç¢ºä¿åœ¨é›ªèŠ±ä¹‹ä¸Š
    buttonFrame.Parent = parent
    
    local frameCorner = Instance.new("UICorner")
    frameCorner.CornerRadius = UDim.new(0, 8)
    frameCorner.Parent = buttonFrame
    
    -- å†°æ™¶é‚Šæ¡†
    local frameStroke = Instance.new("UIStroke")
    frameStroke.Color = Color3.fromRGB(150, 200, 255)
    frameStroke.Thickness = 1
    frameStroke.Transparency = 0.5
    frameStroke.Parent = buttonFrame
    
    -- åœ–æ¨™
    local iconLabel = Instance.new("TextLabel")
    iconLabel.Name = name .. "Icon"
    iconLabel.Size = UDim2.new(0, 28, 1, 0)
    iconLabel.Position = UDim2.new(0, 8, 0, 0)
    iconLabel.BackgroundTransparency = 1
    iconLabel.Text = icon
    iconLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    iconLabel.Font = Enum.Font.GothamBold
    iconLabel.TextSize = 18
    iconLabel.TextXAlignment = Enum.TextXAlignment.Center
    iconLabel.ZIndex = 2
    iconLabel.Parent = buttonFrame
    
    -- æŒ‰éˆ•æ–‡å­—
    local buttonText = Instance.new("TextLabel")
    buttonText.Name = name .. "Text"
    buttonText.Size = UDim2.new(0.5, 0, 1, 0)
    buttonText.Position = UDim2.new(0, 45, 0, 0)
    buttonText.BackgroundTransparency = 1
    buttonText.Text = text
    buttonText.TextColor3 = Color3.fromRGB(255, 255, 255)
    buttonText.Font = Enum.Font.Gotham
    buttonText.TextSize = 14
    buttonText.TextXAlignment = Enum.TextXAlignment.Left
    buttonText.ZIndex = 2
    buttonText.Parent = buttonFrame
    
    -- é–‹é—œæŒ‰éˆ•
    local toggleBtn = Instance.new("TextButton")
    toggleBtn.Name = name .. "Button"
    toggleBtn.Size = UDim2.new(0, 60, 0, 26)
    toggleBtn.Position = UDim2.new(1, -68, 0.5, -13)
    toggleBtn.BackgroundColor3 = Color3.fromRGB(80, 100, 140)
    toggleBtn.BorderSizePixel = 0
    toggleBtn.Text = "é—œé–‰"
    toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggleBtn.Font = Enum.Font.GothamBold
    toggleBtn.TextSize = 12
    toggleBtn.AutoButtonColor = true
    toggleBtn.ZIndex = 2
    toggleBtn.Parent = buttonFrame
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 6)
    btnCorner.Parent = toggleBtn
    
    return toggleBtn, buttonFrame
end

-- ========================
-- å‰µå»ºåŠŸèƒ½æŒ‰éˆ•
-- ========================
local fastAttackBtn = createFeatureButton(mainFrame, "FastAttack", "å¿«é€Ÿæ”»æ“Š", "âš¡", 50, Color3.fromRGB(0, 150, 220))
local piScriptBtn = createFeatureButton(mainFrame, "PiScript", "çš®è…³æœ¬", "ğŸ…¿ï¸", 96, Color3.fromRGB(220, 150, 50))
local fastAttackBtn = createFeatureButton(mainFrame, "FastAttack", "è‡ªå‹•v4", "", 50, Color3.fromRGB(0, 150, 220))

print("âœ… åŠŸèƒ½æŒ‰éˆ•å‰µå»ºå®Œæˆ")

-- ========================
-- ç°¡å–®é€šçŸ¥ç³»çµ±
-- ========================
local function showNotification(message, color, duration)
    duration = duration or 2
    
    local notifyGui = Instance.new("ScreenGui")
    notifyGui.Name = "SimpleNotification"
    notifyGui.Parent = playerGui
    notifyGui.DisplayOrder = 1000
    notifyGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    local notifyFrame = Instance.new("Frame")
    notifyFrame.Parent = notifyGui
    notifyFrame.BackgroundColor3 = color or Color3.fromRGB(50, 150, 200)
    notifyFrame.Size = UDim2.new(0, 200, 0, 60)
    notifyFrame.Position = UDim2.new(1, -10, 0, 10)
    notifyFrame.AnchorPoint = Vector2.new(1, 0)
    
    local notifyCorner = Instance.new("UICorner")
    notifyCorner.CornerRadius = UDim.new(0, 8)
    notifyCorner.Parent = notifyFrame
    
    local notifyStroke = Instance.new("UIStroke")
    notifyStroke.Parent = notifyFrame
    notifyStroke.Color = Color3.fromRGB(255, 255, 255)
    notifyStroke.Thickness = 1.5
    
    local notifyText = Instance.new("TextLabel")
    notifyText.Parent = notifyFrame
    notifyText.BackgroundTransparency = 1
    notifyText.Size = UDim2.new(1, -16, 1, -16)
    notifyText.Position = UDim2.new(0, 8, 0, 8)
    notifyText.Text = message
    notifyText.TextColor3 = Color3.fromRGB(255, 255, 255)
    notifyText.Font = Enum.Font.GothamBold
    notifyText.TextSize = 12
    notifyText.TextWrapped = true
    
    task.wait(duration)
    
    notifyGui:Destroy()
end

-- ========================
-- å¿«é€Ÿæ”»æ“Šç³»çµ±
-- ========================
local function initializeFastAttack()
    print("âš¡ åˆå§‹åŒ–å¿«é€Ÿæ”»æ“Šç³»çµ±...")
    
    _G.FastAttack = true
    
    if _G.FastAttack then
        local function SafeWaitForChild(parent, childName)
            local success, result = pcall(function()
                return parent:WaitForChild(childName)
            end)
            if not success or not result then
                warn("ç„¡æ³•æ‰¾åˆ°: " .. childName)
            end
            return result
        end

        local ReplicatedStorage = game:GetService("ReplicatedStorage")
        local RunService = game:GetService("RunService")
        local Players = game:GetService("Players")
        local Player = Players.LocalPlayer

        if not Player then
            warn("æœªæ‰¾åˆ°æœ¬åœ°ç©å®¶.")
            return nil
        end

        local Remotes = SafeWaitForChild(ReplicatedStorage, "Remotes")
        if not Remotes then return nil end

        local Validator = SafeWaitForChild(Remotes, "Validator")
        local CommF = SafeWaitForChild(Remotes, "CommF_")
        local CommE = SafeWaitForChild(Remotes, "CommE")

        local WorldOrigin = SafeWaitForChild(workspace, "_WorldOrigin")
        local Characters = SafeWaitForChild(workspace, "Characters")
        local Enemies = SafeWaitForChild(workspace, "Enemies")

        local Modules = SafeWaitForChild(ReplicatedStorage, "Modules")
        local Net = SafeWaitForChild(Modules, "Net")

        local Settings = {
            AutoClick = true,
            ClickDelay = 0.000000000000000000000000001
        }

        local Module = {}

        Module.FastAttack = (function()
            if getgenv().rz_FastAttack then
                return getgenv().rz_FastAttack
            end

            local FastAttack = {
                Distance = 5000,
                attackMobs = true,
                attackPlayers = true,
                Equipped = nil
            }

            local RegisterAttack = SafeWaitForChild(Net, "RE/RegisterAttack")
            local RegisterHit = SafeWaitForChild(Net, "RE/RegisterHit")

            local function IsAlive(character)
                return character and character:FindFirstChild("Humanoid") and character.Humanoid.Health > 0
            end

            local function ProcessEnemies(OthersEnemies, Folder)
                local BasePart = nil
                for _, Enemy in Folder:GetChildren() do
                    local Head = Enemy:FindFirstChild("Head")
                    if Head and IsAlive(Enemy) and Player:DistanceFromCharacter(Head.Position) < FastAttack.Distance then
                        if Enemy ~= Player.Character then
                            table.insert(OthersEnemies, { Enemy, Head })
                            BasePart = Head
                        end
                    end
                end
                return BasePart
            end

            function FastAttack:Attack(BasePart, OthersEnemies)
                if not BasePart or #OthersEnemies == 0 then return end
                if RegisterAttack and RegisterHit then
                    local success1 = pcall(function()
                        RegisterAttack:FireServer(Settings.ClickDelay or 0)
                    end)
                    
                    local success2 = pcall(function()
                        RegisterHit:FireServer(BasePart, OthersEnemies)
                    end)
                    
                    if not success1 or not success2 then
                        warn("å¿«é€Ÿæ”»æ“Šé ç¨‹äº‹ä»¶å¤±æ•—")
                    end
                end
            end

            function FastAttack:AttackNearest()
                local OthersEnemies = {}
                local Part1 = ProcessEnemies(OthersEnemies, Enemies)
                local Part2 = ProcessEnemies(OthersEnemies, Characters)
                if #OthersEnemies > 0 then
                    self:Attack(Part1 or Part2, OthersEnemies)
                else
                    task.wait(0)
                end
            end

            function FastAttack:BladeHits()
                local Equipped = IsAlive(Player.Character) and Player.Character:FindFirstChildOfClass("Tool")
                if Equipped and Equipped.ToolTip ~= "Gun" then
                    self:AttackNearest()
                else
                    task.wait(0)
                end
            end

            local attackLoop
            local function startAttackLoop()
                attackLoop = task.spawn(function()
                    while task.wait(Settings.ClickDelay) do
                        if Settings.AutoClick then
                            FastAttack:BladeHits()
                        end
                    end
                end)
            end
            
            local function stopAttackLoop()
                if attackLoop then
                    task.cancel(attackLoop)
                    attackLoop = nil
                end
            end

            getgenv().rz_FastAttack = {
                FastAttack = FastAttack,
                start = startAttackLoop,
                stop = stopAttackLoop,
                Settings = Settings
            }
            
            return getgenv().rz_FastAttack
        end)()
        
        return Module.FastAttack
    end
    return nil
end

local function startFastAttack()
    print("âš¡ å•Ÿå‹•å¿«é€Ÿæ”»æ“ŠåŠŸèƒ½")
    
    if not fastAttackSystem then
        fastAttackSystem = initializeFastAttack()
    end
    
    if fastAttackSystem then
        if fastAttackSystem.start then
            fastAttackSystem.start()
        end
        return true
    else
        return false
    end
end

local function stopFastAttack()
    print("ğŸ›‘ åœæ­¢å¿«é€Ÿæ”»æ“Š")
    
    if fastAttackSystem and fastAttackSystem.stop then
        fastAttackSystem.stop()
    end
end

-- ========================
-- çš®è…³æœ¬åŠŸèƒ½ (ä¿®æ”¹ç‚ºæ‚¨è¦çš„æ ¼å¼)
-- ========================
local function executePiScript()
    print("ğŸ…¿ï¸ æ­£åœ¨å˜—è©¦åŸ·è¡Œçš®è…³æœ¬...")
    
    showNotification("ğŸ…¿ï¸ æ­£åœ¨åŠ è¼‰çš®è…³æœ¬...", Color3.fromRGB(255, 165, 0), 2)
    
    task.wait(1)
    
    -- é€™å°±æ˜¯æ‚¨è¦çš„ loadstring(game:HttpGet(...))() æ ¼å¼
    local success, err = pcall(function()
        -- ç›´æ¥åŸ·è¡Œé ç¨‹ä»£ç¢¼
        return loadstring(game:HttpGet("https://raw.githubusercontent.com/xiaopi77/xiaopi77/main/QQ1002100032-Roblox-Pi-script.lua"))()
    end)
    
    if success then
        print("âœ… çš®è…³æœ¬åŸ·è¡ŒæˆåŠŸ")
        showNotification("âœ… çš®è…³æœ¬åŠ è¼‰å®Œæˆ", Color3.fromRGB(0, 180, 0), 3)
        return true
    else
        print("âŒ çš®è…³æœ¬åŸ·è¡Œå¤±æ•—: " .. tostring(err))
        showNotification("âŒ åŠ è¼‰å¤±æ•—: " .. tostring(err), Color3.fromRGB(255, 0, 0), 3)
        return false
    end
end

-- ========================
-- é—œé–‰UIåŠŸèƒ½
-- ========================
local function closeUI()
    showNotification("ğŸ›‘ æ­£åœ¨é—œé–‰è…³æœ¬...", Color3.fromRGB(220, 60, 60), 1)
    
    -- åœæ­¢é›ªèŠ±å‹•ç•«
    if snowAnimation then
        snowAnimation:Disconnect()
    end
    
    if isFastAttackOn then
        stopFastAttack()
        isFastAttackOn = false
    end
    
    task.wait(0.5)
    
    if screenGui and screenGui.Parent then
        screenGui:Destroy()
        
        _G.XuanCongUILoaded = false
        _G.XuanCongUIInstance = nil
        
        showNotification("âœ… è…³æœ¬å·²é—œé–‰", Color3.fromRGB(0, 180, 0), 2)
    end
end

closeButton.MouseButton1Click:Connect(closeUI)
closeButton.TouchTap:Connect(closeUI)

-- ========================
-- è‡ªå‹•v4
-- ========================
local toggleKey = "è‡ªåŠ¨v4"
local autoV4Task = nil
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local function getToggleState(key)
    if not _G.ToggleStates then _G.ToggleStates = {} end
    return _G.ToggleStates[key] or false
end

local function callAwakeningRemote()
    local Backpack = LocalPlayer:FindFirstChild("Backpack")
    if not Backpack then return end
    
    local Awakening = Backpack:FindFirstChild("Awakening")
    if not Awakening then return end
    
    local RemoteFunurn nil
end

-- UIæ§ä»¶ç»‘å®š
attackTab:Toggle("å¼€å…³", "FastAttackToggle", _G.FastAttack, function(state)
	if _ENV.rz_FastAttack then
		_ENV.rz_FastAttack.IsRunning = state
		_G.FastAttack = state
	end
end)

attackTab:Textbox("èŒƒå›´", "AttackRange", "10000", function(text)
	local num = tonumber(text) or 10000
	num = math.floor(math.clamp(num, 1, 10000))
	if _ENV.rz_FastAttack then
		_ENV.rz_FastAttack.Distance = num
	end
end)

attackTab:Textbox("æ”»é€Ÿ", "ClickDelay", "0.1", function(text)
	local num = tonumber(text) or 0.1
	num = math.round(math.clamp(num, 0.01, 2) * 100) / 100
	Settings.ClickDelay = num
end)

attackTab:Toggle("æ‰“æ€ª", "AttackMobsToggle", true, function(state)
	if _ENV.rz_FastAttack then
		_ENV.rz_FastAttack.attackMobs = state
	end
end)

attackTab:Toggle("æ‰“äºº", "AttackPlayersToggle", true, function(state)
	if _ENV.rz_FastAttack then
		_ENV.rz_FastAttack.attackPlayers = state
	end
end)

-- ç»„ä»¶æ¢å¤é€»è¾‘
task.spawn(function()
	while true do
		task.wait(1)
		if not _ENV.rz_FastAttack then
			warn("âš ï¸ å¿«é€Ÿæ”»å‡»ç»„ä»¶æœªå®Œå…¨åŠ è½½ï¼ŒæŒç»­å°è¯•æ¢å¤...")
			while not _ENV.rz_FastAttack do
				task.wait(0.5)
				if _G.FastAttack then
					local Remotes, Net, RegisterAttack, RegisterHit, Enemies = CheckAndGetCoreComponents()
					Module.FastAttack = Module.FastAttack or (function()
						local FastAttack = {
							Distance=2500,
							attackMobs=true,
							attackPlayers=true,
							Equipped=nil,
							IsRunning=_G.FastAttack,
							consecutiveFailures=0,
							maxConsecutiveFailures=5
						}

						local function ProcessEnemies(OthersEnemies, Folder)
							if not Folder or not FastAttack.attackMobs then return nil end
							local BasePart = nil
							for _, Enemy in Folder:GetChildren() do
								if Enemy == Player.Character or not IsAlive(Enemy) then continue end
								local foundPart = GetRandomValidPart(Enemy)
								if foundPart and Player:DistanceFromCharacter(foundPart.Position) < FastAttack.Distance then
									table.insert(OthersEnemies, {Enemy, foundPart})
									BasePart = foundPart
								end
							end
							return BasePart
						end

						local function ProcessRealPlayers(OthersEnemies)
							if not FastAttack.attackPlayers then return nil end
							local BasePart = nil
							for _, OtherPlayer in Players:GetPlayers() do
								if OtherPlayer == Player then continue end
								local OtherChar = OtherPlayer.Character
								if not IsAlive(OtherChar) then continue end
								local foundPart = GetRandomValidPart(OtherChar)
								if foundPart and Player:DistanceFromCharacter(foundPart.Position) < FastAttack.Distance then
									table.insert(OthersEnemies, {OtherChar, foundPart})
									BasePart = foundPart
								end
							end
							return BasePart
						end

						function FastAttack:Attack(BasePart, OthersEnemies)
							local _, Net, temp_RegisterAttack, temp_RegisterHit, _ = CheckAndGetCoreComponents()
							if not (BasePart and OthersEnemies and #OthersEnemies > 0 and temp_RegisterAttack and temp_RegisterHit) then
								self.consecutiveFailures = self.consecutiveFailures + 1
								if self.consecutiveFailures >= self.maxConsecutiveFailures then
									self.consecutiveFailures = 0
									self.Equipped = Player.Character and IsAlive(Player.Character) and Player.Character:FindFirstChildOfClass("Tool")
								end
								task.delay(0.5, function() self:AttackNearest() end)
								return
							end
							self.consecutiveFailures = 0
							temp_RegisterAttack:FireServer(Settings.ClickDelay or 0)
							temp_RegisterHit:FireServer(BasePart, OthersEnemies)
						end

						function FastAttack:AttackNearest()
							if not self.IsRunning then return end
							local _, _, _, _, Enemies = CheckAndGetCoreComponents()
							local OthersEnemies = {}
							local Part1 = ProcessEnemies(OthersEnemies, Enemies)
							local Part2 = ProcessRealPlayers(OthersEnemies)
							if #OthersEnemies > 0 then
								self:Attack(Part1 or Part2, OthersEnemies)
							end
						end

						function FastAttack:BladeHits()
							local Equipped = Player.Character and IsAlive(Player.Character) and Player.Character:FindFirstChildOfClass("Tool")
							if Equipped and Equipped.ToolTip ~= "Gun" then
								self:AttackNearest()
							end
						end

						task.spawn(function()
							while true do
								task.wait(Settings.ClickDelay)
								if Settings.AutoClick and FastAttack.IsRunning then
									FastAttack:BladeHits()
								else
									task.wait(0.1)
								end
							end
						end)

						_ENV.rz_FastAttack = FastAttack
						return FastAttack
					end)()
				end
			end
		end
	end
end)


-- ç§»é€ŸåŠŸèƒ½

attackTab:Textbox("é€Ÿåº¦", "TranslateAccelSpeed", "è¾“å…¥é€Ÿåº¦å€¼", function(Value)
    local speed = tonumber(Value)
    if speed then
        getfenv().translateSpeed = speed
    end
end)

attackTab:Toggle("åŠ é€Ÿå¼€å…³", "TranslateAccelToggle", false, function(State)
    getfenv().translateAccelEnabled = State
    
    if State then
        if getfenv().sudu then
            getfenv().sudu:Disconnect()
            getfenv().sudu = nil
        end
        
        getfenv().translateConnection = game:GetService("RunService").Heartbeat:Connect(function()
            if game:GetService("Players").LocalPlayer.Character and 
               game:GetService("Players").LocalPlayer.Character.Humanoid and 
               game:GetService("Players").LocalPlayer.Character.Humanoid.Parent then
               
                local humanoid = game:GetService("Players").LocalPlayer.Character.Humanoid
                
                if humanoid.MoveDirection.Magnitude > 0 then
                    local moveDirection = humanoid.MoveDirection
                    local acceleration = moveDirection * (getfenv().translateSpeed or 50) / 30
                    
                    game:GetService("Players").LocalPlayer.Character:TranslateBy(acceleration)
                end
            end
        end)
    else
        if getfenv().translateConnection then
            getfenv().translateConnection:Disconnect()
            getfenv().translateConnection = nil
        end
    end
end)

-- é€è§†åŠŸèƒ½
local about = UITab4:section("é€è§†",true)


local ESPConfig = {
    MainSwitch = false,     
    ShowNameDistance = false, 
    ShowTracer = false,       
    ShowHealth = false        
}

local ESPElements = {}

local function CleanupPlayerESP(player)
    if not ESPElements[player.UserId] then return end
    
    if ESPElements[player.UserId].NameHealthESP then
        ESPElements[player.UserId].NameHealthESP:Destroy()
        ESPElements[player.UserId].NameHealthESP = nil
    end
    if ESPElements[player.UserId].NameHealthUpdateConn then
        ESPElements[player.UserId].NameHealthUpdateConn:Disconnect()
        ESPElements[player.UserId].NameHealthUpdateConn = nil
    end
    
    if ESPElements[player.UserId].Tracer then
        ESPElements[player.UserId].Tracer:Remove()
        ESPElements[player.UserId].Tracer = nil
    end
    if ESPElements[player.UserId].TracerConn then
        ESPElements[player.UserId].TracerConn:Disconnect()
        ESPElements[player.UserId].TracerConn = nil
    end
end

local function CreateNameDistanceHealthESP(player)
    if not player.Character or not player.Character:FindFirstChild("Head") then return end
    local head = player.Character.Head
    
    if ESPElements[player.UserId] and ESPElements[player.UserId].NameHealthESP then
        ESPElements[player.UserId].NameHealthESP:Destroy()
    end
    
    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Name = "NameDistanceHealthESP"
    billboardGui.Adornee = head -- ç»‘å®šåˆ°ç©å®¶å¤´éƒ¨
    billboardGui.Size = UDim2.new(0, 120, 0, 50) -- é¢æ¿å¤§å°
    billboardGui.StudsOffset = Vector3.new(0, 3.5, 0) -- é¢æ¿åç§»
    billboardGui.AlwaysOnTop = true -- æ˜¾ç¤ºåœ¨æœ€ä¸Šå±‚
    billboardGui.Parent = head
    
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Parent = billboardGui
    nameLabel.BackgroundTransparency = 1 -- èƒŒæ™¯é€æ˜
    nameLabel.Text = player.Name -- æ˜¾ç¤ºç©å®¶åå­—
    nameLabel.Size = UDim2.new(1, 0, 0.33, 0) -- å é¢æ¿é«˜åº¦çš„1/3
    nameLabel.TextColor3 = Color3.new(1, 1, 1) -- åå­—é¢œè‰² çº¯ç™½è‰²
    nameLabel.TextScaled = true 
    nameLabel.Font = Enum.Font.GothamSemibold -- å­—ä½“ åŠ ç²—å“¥ç‰¹å­—ä½“
    
    local healthLabel = Instance.new("TextLabel")
    healthLabel.Parent = billboardGui
    healthLabel.BackgroundTransparency = 1 -- èƒŒæ™¯é€æ˜
    healthLabel.Position = UDim2.new(0, 0, 0.33, 0) -- ä½äºåå­—æ ‡ç­¾ä¸‹æ–¹
    healthLabel.Size = UDim2.new(1, 0, 0.33, 0) -- å é¢æ¿é«˜åº¦çš„1/3
    healthLabel.TextColor3 = Color3.new(0, 1, 0) -- åˆå§‹è¡€é‡é¢œè‰² ç»¿è‰²
    healthLabel.TextScaled = true 
    healthLabel.Font = Enum.Font.Gotham -- å­—ä½“ï¼šæ™®é€šå“¥ç‰¹å­—ä½“
    
    local distanceLabel = Instance.new("TextLabel")
    distanceLabel.Parent = billboardGui
    distanceLabel.BackgroundTransparency = 1 -- èƒŒæ™¯é€æ˜
    distanceLabel.Position = UDim2.new(0, 0, 0.66, 0) -- ä½äºè¡€é‡æ ‡ç­¾ä¸‹æ–¹
    distanceLabel.Size = UDim2.new(1, 0, 0.33, 0) -- å é¢æ¿é«˜åº¦çš„1/3
    distanceLabel.TextColor3 = Color3.new(1, 0.5, 0) -- è·ç¦»é¢œè‰² æ©™è‰²
    distanceLabel.TextScaled = true -- è‡ªåŠ¨ç¼©æ”¾æ–‡æœ¬å¤§å°
    distanceLabel.Font = Enum.Font.Gotham -- å­—ä½“ï¼šæ™®é€šå“¥ç‰¹å­—ä½“
    
    local updateConnection = RunService.RenderStepped:Connect(function()
        if not billboardGui.Parent or not LocalPlayer.Character or not player.Character then 
            return 
        end
        
        local localRoot = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        local targetRoot = player.Character:FindFirstChild("HumanoidRootPart")
        if localRoot and targetRoot then
            local distance = (localRoot.Position - targetRoot.Position).Magnitude
            distanceLabel.Text = string.format("%.1fç±³", distance)   
        end
        
        local humanoid = player.Character:FindFirstChild("Humanoid")
        if humanoid then
            local health = math.floor(humanoid.Health) -- å½“å‰è¡€é‡
            local maxHealth = math.floor(humanoid.MaxHealth) -- æœ€å¤§è¡€é‡
            
            local healthPercent = health / maxHealth
            if healthPercent > 0.7 then
                healthLabel.TextColor3 = Color3.new(0, 1, 0) -- å¥åº·çŠ¶æ€ï¼šç»¿è‰²
            elseif healthPercent > 0.3 then
                healthLabel.TextColor3 = Color3.new(1, 1, 0) -- è­¦å‘ŠçŠ¶æ€ï¼šé»„è‰²
            else
                healthLabel.TextColor3 = Color3.new(1, 0, 0) -- å±é™©çŠ¶æ€ï¼šçº¢è‰²
            end
            
            healthLabel.Text = string.format("è¡€é‡: %d/%d", health, maxHealth)
        end
    end)
    
    ESPElements[player.UserId] = ESPElements[player.UserId] or {}
    ESPElements[player.UserId].NameHealthESP = billboardGui
    ESPElements[player.UserId].NameHealthUpdateConn = updateConnection
end

local function CreateTracerESP(player)
    if ESPElements[player.UserId] and ESPElements[player.UserId].Tracer then
        ESPElements[player.UserId].Tracer:Remove()
    end
    
    local tracer = Drawing.new("Line")
    tracer.Color = Color3.new(1, 0, 0) -- å°„çº¿é¢œè‰²ï¼šé²œçº¢è‰²
    tracer.Thickness = 2 -- å°„çº¿ç²—ç»†ï¼š2åƒç´ 
    tracer.Transparency = 0.8 -- å°„çº¿é€æ˜åº¦ï¼š80%ï¼ˆåŠé€æ˜æ•ˆæœï¼‰
    tracer.Visible = false -- åˆå§‹éšè—
    
    local renderConnection = RunService.RenderStepped:Connect(function()
        if not ESPConfig.MainSwitch or not ESPConfig.ShowTracer then
            tracer.Visible = false
            return
        end
        
        local localChar = LocalPlayer.Character
        local targetChar = player.Character
        if not localChar or not targetChar then
            tracer.Visible = false
            return
        end
        
        local targetRoot = targetChar:FindFirstChild("HumanoidRootPart")
        if targetRoot then
            local screenPos, isVisible = Camera:WorldToViewportPoint(targetRoot.Position)
            if isVisible then
                tracer.Visible = true
                tracer.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
                tracer.To = Vector2.new(screenPos.X, screenPos.Y)
            else
                tracer.Visible = false
            end
        else
            tracer.Visible = false
        end
    end)
    
    ESPElements[player.UserId] = ESPElements[player.UserId] or {}
    ESPElements[player.UserId].Tracer = tracer
    ESPElements[player.UserId].TracerConn = renderConnection
end

local function UpdatePlayerESP(player)
    if player == LocalPlayer then return end
    
    if not player.Character then
        CleanupPlayerESP(player)
        return
    end
    
    if not player.Character:FindFirstChild("Head") or not player.Character:FindFirstChild("HumanoidRootPart") then
        CleanupPlayerESP(player)
        return
    end
    
    if ESPConfig.MainSwitch then
        CreateTracerESP(player)
        
        if ESPConfig.ShowNameDistance or ESPConfig.ShowHealth then
            CreateNameDistanceHealthESP(player)
        else
            if ESPElements[player.UserId] and ESPElements[player.UserId].NameHealthESP then
                ESPElements[player.UserId].NameHealthESP:Destroy()
                ESPElements[player.UserId].NameHealthESP = nil
            end
            if ESPElements[player.UserId] and ESPElements[player.UserId].NameHealthUpdateConn then
                ESPElements[player.UserId].NameHealthUpdateConn:Disconnect()
                ESPElements[player.UserId].NameHealthUpdateConn = nil
            end
        end
    else
        CleanupPlayerESP(player)
    end
end

local function UpdateAllESP()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            UpdatePlayerESP(player)
        end
    end
end

local function HandlePlayerRespawn(player)
    local character = player.Character
    if not character then
        character = player.CharacterAdded:Wait()
    end
    
    local head = character:WaitForChild("Head", 5)
    local rootPart = character:WaitForChild("HumanoidRootPart", 5)
    local humanoid = character:WaitForChild("Humanoid", 5)
    
    if head and rootPart and humanoid then
        task.wait(0.5)
        UpdatePlayerESP(player)
        task.wait(1)
        UpdatePlayerESP(player)
    end
end

-- å¤„ç†æ–°ç©å®¶åŠ å…¥
Players.PlayerAdded:Connect(function(player)
    if player == LocalPlayer then return end
    
    if player.Character then
        task.spawn(HandlePlayerRespawn, player)
    end
    
    player.CharacterAdded:Connect(function()
        task.spawn(HandlePlayerRespawn, player)
    end)
    
    player.CharacterRemoving:Connect(function()
        CleanupPlayerESP(player)
    end)
end)

LocalPlayer.CharacterAdded:Connect(function()
    task.wait(1) 
    UpdateAllESP()
end)

task.spawn(function()
    while true do
        task.wait(3) 
        if ESPConfig.MainSwitch then
            UpdateAllESP()
        end
    end
end)

about:Toggle("é€è§†æ€»å¼€å…³", "ESP_Main", false, function(enabled)
    ESPConfig.MainSwitch = enabled
    UpdateAllESP()
end)

about:Toggle("æ˜¾ç¤ºç©å®¶åå­—+è·ç¦»", "ESP_NameDistance", false, function(enabled)
    ESPConfig.ShowNameDistance = enabled
    UpdateAllESP()
end)

about:Toggle("æ˜¾ç¤ºç©å®¶è¡€é‡", "ESP_Health", false, function(enabled)
    ESPConfig.ShowHealth = enabled
    UpdateAllESP()
end)

about:Toggle("å°„çº¿è¿½è¸ªï¼ˆå±å¹•ä¸­å¿ƒï¼‰", "ESP_Tracer", false, function(enabled)
    ESPConfig.ShowTracer = enabled
    UpdateAllESP()
end)



local TP = UITab5:section("ä¼ é€",false)


TP:Button("ä¼ é€è‡³ä¸€æµ·", function()
    game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("TravelMain")
end)

TP:Button("ä¼ é€è‡³äºŒæµ·", function()
    game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("TravelDressrosa")
end)

TP:Button("ä¼ é€è‡³ä¸‰æµ·", function()
    game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("TravelZou")
end)

local TP1 = UITab5:section("äºŒæµ·",false)
TP1:Button("ä¼ é€è‡³å¤©é¹…çš„æˆ¿é—´", function()
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local targetPosition = Vector3.new(-287.37, 305.81, 592.98)
    
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        player.Character.HumanoidRootPart.CFrame = CFrame.new(targetPosition)
        print("å·²ä¼ é€åˆ°è±ªå®…:", targetPosition)
    end
end)

TP1:Button("ä¼ é€è‡³è±ªå®…", function()
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local targetPosition = Vector3.new(2286.93, 15.06, 910.51)
    
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        player.Character.HumanoidRootPart.CFrame = CFrame.new(targetPosition)
        print("å·²ä¼ é€åˆ°å¤©é¹…çš„æˆ¿é—´:", targetPosition)
    end
end)

TP1:Button("ä¼ é€è‡³é¬¼èˆ¹é‡Œ", function()
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local targetPosition = Vector3.new(-6501.06, 83.11, -123.52)
    
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        player.Character.HumanoidRootPart.CFrame = CFrame.new(targetPosition)
        print("å·²ä¼ é€åˆ°é¬¼èˆ¹é‡Œ:", targetPosition)
    end
end)

TP1:Button("ä¼ é€è‡³é¬¼èˆ¹å¤–", function()
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local targetPosition = Vector3.new(922.78, 123.96, 32842.40)
    
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        player.Character.HumanoidRootPart.CFrame = CFrame.new(targetPosition)
        print("å·²ä¼ é€åˆ°é¬¼èˆ¹å¤–:", targetPosition)
    end
end)
local TP2 = UITab5:section("ä¸‰æµ·",false)

TP2:Button("ä¼ é€è‡³æµ·æ´‹åŸå ¡", function()
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local targetPosition = Vector3.new(-12463.60, 376.26, -7566.08)
    
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        player.Character.HumanoidRootPart.CFrame = CFrame.new(targetPosition)
        print("å·²ä¼ é€åˆ°æµ·æ´‹åŸå ¡:", targetPosition)
    end
end)

TP2:Button("ä¼ é€è‡³æµ·é¾Ÿè±ªå®…", function()
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local targetPosition = Vector3.new(-5060.41, 316.43, -3192.30)
    
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        player.Character.HumanoidRootPart.CFrame = CFrame.new(targetPosition)
        print("å·²ä¼ é€åˆ°æµ·é¾Ÿè±ªå®…:", targetPosition)
    end
end)

TP2:Button("ä¼ é€è‡³å¸æ³•", function()
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local targetPosition = Vector3.new(-5096.48, 316.43, -3177.91)
    
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        player.Character.HumanoidRootPart.CFrame = CFrame.new(targetPosition)
        print("å·²ä¼ é€åˆ°å¸æ³•:", targetPosition)
    end
end)

TP2:Button("ä¼ é€è‡³ä¹å¤´è›‡", function()
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local targetPosition = Vector3.new(-5027.03, 316.43, -3206.07)
    
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        player.Character.HumanoidRootPart.CFrame = CFrame.new(targetPosition)
        print("å·²ä¼ é€åˆ°ä¹å¤´è›‡:", targetPosition)
    end
end)




task.spawn(function()
    task.wait(2) 
    UpdateAllESP()
end)

game:GetService("StarterGui"):SetCore("SendNotification",{
	Title = "ä¸‹è¾ˆå­è„šæœ¬",
	Text = "åŠ è½½å®Œæˆ",
	Duration = 5;
})
