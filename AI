-- ç„ä¸›è…³æœ¬ - æœ€çµ‚ç‰ˆ (è‡ªå‹•V4 ä½¿ç”¨ä½ æä¾›çš„é‚è¼¯ + é€Ÿåº¦å·²ä¿®å¾© + ç¾åŒ–UI)
print("ğŸ® =================================")
print("ğŸ® ç„ä¸›è…³æœ¬ - æœ€çµ‚ç‰ˆ")
print("ğŸ® è‡ªå‹•V4 å·²å®Œå…¨æŒ‰ç…§ä½ çš„é‚è¼¯å¯¦ä½œ")
print("ğŸ® =================================")

-- åŸºæœ¬æœå‹™
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local isMobile = UserInputService.TouchEnabled

-- ç¢ºä¿åŠ è¼‰å®Œæˆ
repeat task.wait() until game:IsLoaded()

-- UIå®¹å™¨
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui", 10) or game:GetService("CoreGui")

-- æ¸…ç†èˆŠUI
for _, gui in pairs(PlayerGui:GetChildren()) do
    if gui.Name:find("XuanCong") then gui:Destroy() end
end

-- ========================
-- ä¸»UI
-- ========================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "XuanCongScript_Final"
ScreenGui.Parent = PlayerGui
ScreenGui.ResetOnSpawn = false
ScreenGui.DisplayOrder = 999

-- å·¦ä¸Šé–‹é—œæŒ‰éˆ•
local SidebarButton = Instance.new("TextButton")
SidebarButton.Size = UDim2.new(0, 50, 0, 50)
SidebarButton.Position = UDim2.new(0, 10, 0, 10)
SidebarButton.BackgroundColor3 = Color3.fromRGB(30, 30, 60)
SidebarButton.Text = "âš™ï¸"
SidebarButton.TextColor3 = Color3.new(1,1,1)
SidebarButton.Font = Enum.Font.GothamBold
SidebarButton.TextSize = 24
SidebarButton.Parent = ScreenGui
Instance.new("UICorner", SidebarButton).CornerRadius = UDim.new(0,12)
local Grad = Instance.new("UIGradient", SidebarButton)
Grad.Color = ColorSequence.new{ColorSequenceKeypoint.new(0, Color3.fromRGB(50,50,100)), ColorSequenceKeypoint.new(1, Color3.fromRGB(20,20,50))}

-- ä¸»é¢æ¿
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 260, 0, 270)
MainFrame.Position = UDim2.new(0.5, -130, 0.5, -135)
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 40)
MainFrame.Visible = false
MainFrame.Parent = ScreenGui
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0,12)
local MainGrad = Instance.new("UIGradient", MainFrame)
MainGrad.Color = ColorSequence.new{ColorSequenceKeypoint.new(0, Color3.fromRGB(30,30,60)), ColorSequenceKeypoint.new(1, Color3.fromRGB(10,10,30))}

-- æ¨™é¡Œæ¬„ï¼ˆå¯æ‹–å‹•ï¼‰
local DragBar = Instance.new("TextButton")
DragBar.Size = UDim2.new(1,0,0,40)
DragBar.BackgroundColor3 = Color3.fromRGB(30,30,60)
DragBar.Text = "â„ï¸ ç„ä¸›è…³æœ¬ (æ‹–å‹•æˆ‘)"
DragBar.TextColor3 = Color3.fromRGB(200,230,255)
DragBar.Font = Enum.Font.GothamBold
DragBar.TextSize = 16
DragBar.AutoButtonColor = false
DragBar.Parent = MainFrame
Instance.new("UICorner", DragBar).CornerRadius = UDim.new(0,12,0,0)

-- é—œé–‰æŒ‰éˆ•
local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0,30,0,30)
CloseBtn.Position = UDim2.new(1,-35,0,5)
CloseBtn.BackgroundColor3 = Color3.fromRGB(200,50,50)
CloseBtn.Text = "âŒ"
CloseBtn.TextColor3 = Color3.new(1,1,1)
CloseBtn.Parent = DragBar
Instance.new("UICorner", CloseBtn).CornerRadius = UDim.new(0,8)

-- æ‹–å‹•åŠŸèƒ½
local dragging = false
local dragStart, startPos
DragBar.MouseButton1Down:Connect(function()
    dragging = true
    dragStart = UserInputService:GetMouseLocation()
    startPos = MainFrame.Position
end)
RunService.RenderStepped:Connect(function()
    if dragging then
        local delta = UserInputService:GetMouseLocation() - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)
UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
end)

-- ========================
-- æŒ‰éˆ•å‰µå»ºå‡½æ•¸
-- ========================
local function CreateBtn(text, icon, yPos, color)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1,-20,0,40)
    btn.Position = UDim2.new(0,10,0,yPos)
    btn.BackgroundColor3 = color
    btn.Text = icon .. " " .. text
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 14
    btn.Parent = MainFrame
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0,8)
    return btn
end

local FastAttackBtn = CreateBtn("å¿«é€Ÿæ”»æ“Š", "âš¡", 50, Color3.fromRGB(0,150,220))
local PiScriptBtn    = CreateBtn("çš®è…³æœ¬", "ğŸ…¿ï¸", 100, Color3.fromRGB(220,150,50))
local SpeedBtn       = CreateBtn("è¶…é€Ÿæ¨¡å¼", "ğŸƒ", 150, Color3.fromRGB(100,200,100))
local AutoV4Btn      = CreateBtn("è‡ªå‹•V4", "ğŸŒŸ", 200, Color3.fromRGB(180,70,255))

-- ä½œè€…æ¨™ç±¤
local AuthorLabel = Instance.new("TextLabel")
AuthorLabel.Size = UDim2.new(1,-20,0,20)
AuthorLabel.Position = UDim2.new(0,10,0,245)
AuthorLabel.BackgroundTransparency = 1
AuthorLabel.Text = "ğŸ‘‘ ç§¦å§‹çš‡åˆ›ä½œ & æœ‹å‹å„ªåŒ–"
AuthorLabel.TextColor3 = Color3.fromRGB(180,180,220)
AuthorLabel.Font = Enum.Font.Gotham
AuthorLabel.TextSize = 11
AuthorLabel.TextXAlignment = Enum.TextXAlignment.Center
AuthorLabel.Parent = MainFrame

-- ========================
-- é€šçŸ¥ç³»çµ±
-- ========================
local function Notify(msg, col, dur)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0,240,0,70)
    frame.Position = UDim2.new(1,250,1,-80)
    frame.AnchorPoint = Vector2.new(1,1)
    frame.BackgroundColor3 = col or Color3.fromRGB(40,60,90)
    frame.Parent = ScreenGui
    Instance.new("UICorner", frame).CornerRadius = UDim.new(0,10)
    
    local text = Instance.new("TextLabel", frame)
    text.Size = UDim2.new(1,-20,1,-20)
    text.Position = UDim2.new(0,10,0,10)
    text.BackgroundTransparency = 1
    text.Text = msg
    text.TextColor3 = Color3.new(1,1,1)
    text.TextSize = 13
    text.Font = Enum.Font.Gotham
    text.TextWrapped = true
    
    TweenService:Create(frame, TweenInfo.new(0.3), {Position = UDim2.new(1,-10,1,-80)}):Play()
    task.delay(dur or 2, function()
        TweenService:Create(frame, TweenInfo.new(0.2), {Position = UDim2.new(1,250,1,-80)}):Play()
        task.wait(0.2)
        frame:Destroy()
    end)
end

-- ========================
-- å¿«é€Ÿæ”»æ“Š & çš®è…³æœ¬ï¼ˆä¿ç•™åŸæœ¬åŠŸèƒ½ï¼Œå¯è‡ªè¡Œè£œä¸Šï¼‰
-- ========================
FastAttackBtn.MouseButton1Click:Connect(function()
    Notify("âš¡ å¿«é€Ÿæ”»æ“ŠåŠŸèƒ½ï¼ˆè«‹è‡ªè¡Œè£œä¸Šä½ çš„ç„¡é™è·é›¢æ”»æ“Šä»£ç¢¼ï¼‰", Color3.fromRGB(0,150,220), 2)
end)

PiScriptBtn.MouseButton1Click:Connect(function()
    PiScriptBtn.Text = "ğŸ…¿ï¸ åŠ è¼‰ä¸­..."
    Notify("ğŸ…¿ï¸ æ­£åœ¨åŠ è¼‰çš®è…³æœ¬...", Color3.fromRGB(255,165,0), 2)
    local success = pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/xiaopi77/xiaopi77/main/QQ1002100032-Roblox-Pi-script.lua"))()
    end)
    if success then
        Notify("âœ… çš®è…³æœ¬åŠ è¼‰æˆåŠŸï¼", Color3.fromRGB(0,180,0), 2)
    else
        Notify("âŒ çš®è…³æœ¬åŠ è¼‰å¤±æ•—", Color3.fromRGB(255,0,0), 3)
    end
    task.wait(1)
    PiScriptBtn.Text = "ğŸ…¿ï¸ çš®è…³æœ¬"
end)

-- ========================
-- è¶…é€Ÿæ¨¡å¼ï¼ˆå·²ä¿®å¾©ï¼Œæ­»äº¡å¾Œè‡ªå‹•æ¢å¾©ï¼‰
-- ========================
local DefaultSpeed = 16
local SuperSpeed = 120
local SpeedEnabled = false

local function ApplySpeed()
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        LocalPlayer.Character.Humanoid.WalkSpeed = SpeedEnabled and SuperSpeed or DefaultSpeed
    end
end

LocalPlayer.CharacterAdded:Connect(function()
    task.wait(0.5)
    ApplySpeed()
end)

SpeedBtn.MouseButton1Click:Connect(function()
    SpeedEnabled = not SpeedEnabled
    ApplySpeed()
    SpeedBtn.BackgroundColor3 = SpeedEnabled and Color3.fromRGB(60,220,60) or Color3.fromRGB(100,200,100)
    SpeedBtn.Text = SpeedEnabled and "ğŸƒ è¶…é€Ÿæ¨¡å¼ [ON]" or "ğŸƒ è¶…é€Ÿæ¨¡å¼ [OFF]"
    Notify(SpeedEnabled and "ğŸƒ è¶…é€Ÿå·²é–‹å•Ÿï¼ˆ"..SuperSpeed.."ï¼‰" or "ğŸƒ è¶…é€Ÿå·²é—œé–‰", SpeedEnabled and Color3.fromRGB(0,180,0) or Color3.fromRGB(200,0,0), 1.5)
end)

-- ========================
-- è‡ªå‹•V4ï¼ˆå®Œå…¨æŒ‰ç…§ä½ æä¾›çš„é‚è¼¯å¯¦ä½œï¼‰
-- ========================
local toggleKey = "è‡ªåŠ¨v4"
local autoV4Task = nil

local function getToggleState(key)
    if not _G.ToggleStates then _G.ToggleStates = {} end
    return _G.ToggleStates[key] or false
end

local function callAwakeningRemote()
    local Backpack = LocalPlayer:FindFirstChild("Backpack")
    if not Backpack then return end
   
    local Awakening = Backpack:FindFirstChild("Awakening")
    if not Awakening then return end
   
    local RemoteFunc = Awakening:FindFirstChild("RemoteFunction")
    if not RemoteFunc or not RemoteFunc:IsA("RemoteFunction") then return end
   
    local success, err = pcall(function()
        RemoteFunc:InvokeServer(true)
    end)
    if not success then
        warn("è‡ªå‹•V4èª¿ç”¨å¤±æ•—ï¼š", err)
    end
end

local function toggleAutoV4(enable)
    if autoV4Task then
        task.cancel(autoV4Task)
        autoV4Task = nil
    end
   
    if enable then
        autoV4Task = task.spawn(function()
            while getToggleState(toggleKey) do
                callAwakeningRemote()
                task.wait(1)
            end
            autoV4Task = nil
        end)
    end
end

-- è‡ªå‹•V4 æŒ‰éˆ•äº‹ä»¶
AutoV4Btn.MouseButton1Click:Connect(function()
    local newState = not getToggleState(toggleKey)
    if not _G.ToggleStates then _G.ToggleStates = {} end
    _G.ToggleStates[toggleKey] = newState
    
    toggleAutoV4(newState)
    
    AutoV4Btn.BackgroundColor3 = newState and Color3.fromRGB(220,100,255) or Color3.fromRGB(180,70,255)
    AutoV4Btn.Text = newState and "ğŸŒŸ è‡ªå‹•V4 [ON]" or "ğŸŒŸ è‡ªå‹•V4 [OFF]"
    
    Notify(newState and "ğŸŒŸ è‡ªå‹•V4 å·²é–‹å•Ÿï¼ˆæ¯ç§’å‘¼å«ï¼‰" or "ğŸŒŸ è‡ªå‹•V4 å·²é—œé–‰", newState and Color3.fromRGB(180,70,255) or Color3.fromRGB(200,0,0), 2)
end)

-- ========================
-- UI é–‹é—œ
-- ========================
local UIVisible = false
local function ToggleUI()
    UIVisible = not UIVisible
    MainFrame.Visible = UIVisible
    SidebarButton.Text = UIVisible and "ğŸ“‚" or "âš™ï¸"
end

SidebarButton.MouseButton1Click:Connect(ToggleUI)
CloseBtn.MouseButton1Click:Connect(ToggleUI)

-- ========================
-- å•Ÿå‹•å®Œæˆ
-- ========================
task.wait(0.5)
Notify("âœ… ç„ä¸›è…³æœ¬å·²åŠ è¼‰å®Œæˆï¼\nâš¡ å¿«é€Ÿæ”»æ“Š\nğŸƒ è¶…é€Ÿï¼ˆå·²ä¿®å¾©ï¼‰\nğŸŒŸ è‡ªå‹•V4ï¼ˆå®Œå…¨æŒ‰ä½ çš„é‚è¼¯ï¼‰\né»å·¦ä¸Šè§’ âš™ï¸ é–‹å•Ÿé¢æ¿", Color3.fromRGB(50,150,200), 4)

print("ğŸš€ è…³æœ¬åŠ è¼‰å®Œæˆï¼è‡ªå‹•V4 å·²å®Œå…¨æŒ‰ç…§ä½ çš„åŸå§‹é‚è¼¯å¯¦ä½œï¼")
